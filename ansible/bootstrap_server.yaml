---
- hosts: all
  become: yes

  vars_prompt:
  - name: username
    prompt: "What is your username?"
    private: no

  tasks:
    - debug:
        msg: 'Logging in as {{ username }}'
    - name: Collect only facts returned by facter
      setup:
        gather_subset:
          - '!all'
          - '!any'
          - facter
    - name: "Create new user named {{ raspi_user }} on Raspbian"
      import_role:
        name: add_local_user
      when: ansible_lsb.id == "Raspbian"
    - name: allow passwordless sudo
      lineinfile:
        path: /etc/sudoers
        state: present
        regexp: '^%sudo'
        line: '%sudo ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s' 

